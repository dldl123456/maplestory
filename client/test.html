<html>
   <body style="overflow: hidden;">
   <button onclick="soundPlay()">Play</button>
   <button onclick="createCharacter()">Character</button>
   <input id="debugInput" />
   <script src="./core/resource.js"></script>
   <script src="./core/sound.js"></script>
   <script src="./core/character.js"></script>
   <script>
      // the test.html uses wz from v062
      var env = {};
      var test = new MapleSound('/Sound.wz/Bgm02.img/MissingYou');
      function soundPlay () {
         test.Play();
      }

      function createCharacter() {
         var char = new MapleCharacter({
            head: '/Character.wz/00012004.img/front/head',
            body: '/Character.wz/00002004.img/stand1/0/body',
            arm: '/Character.wz/00002004.img/stand1/0/arm',
            _: {
               head: {x: 0, y: 0, z:1},
               body: {x: 5, y: 34, z:0},
               arm: {x: 21, y: 35, z:10}
            }
         });
         char.Assemble().then(function () {
            var img = document.createElement('img');
            // img.id = 'debugImg';
            img.style.position = 'absolute';
            img.src = char.ImageURLBlob();
            document.body.appendChild(img);
         });
      }

      document.body.addEventListener('click', function (evt) {
         if (evt.which !== 1) return;
         if (env.move) {
            env.move = null;
            return;
         }
         if (evt.target.tagName.toLowerCase() !== 'img') return;
         env.move = evt.target;
      });
      document.body.addEventListener('mousemove', function (evt) {
         if (!env.move) return;
         env.move.style.top = (evt.clientY - env.move.offsetHeight / 2) + 'px';
         env.move.style.left = (evt.clientX - env.move.offsetWidth / 2) + 'px';
      });
      document.body.addEventListener('keydown', function (evt) {
         switch(evt.code) {
            case 'ArrowLeft':
               if (!env.move) return;
               if (env.move.offsetLeft <= 0) return;
               env.move.style.left = (env.move.offsetLeft - 10) + 'px';
               return;
            case 'ArrowRight':
               if (!env.move) return;
               if (env.move.offsetLeft + env.move.offsetWidth >= window.innerWidth) return;
               env.move.style.left = (env.move.offsetLeft + 10) + 'px';
               return;
            case 'ArrowUp':
               if (!env.move) return;
               if (env.move.offsetTop <= 0) return;
               env.move.style.top = (env.move.offsetTop - 10) + 'px';
               return;
            case 'ArrowDown':
               if (!env.move) return;
               if (env.move.offsetTop + env.move.offsetHeight >= window.innerHeight) return;
               env.move.style.top = (env.move.offsetTop + 10) + 'px';
               return;
         }
      });
      document.querySelector('#debugInput').addEventListener('keypress', charOpen);
      function charOpen(evt) {
         if (evt.code !== 'Enter') return;
         var input = document.querySelector('#debugInput');
         MapleResourceManager.Get(input.value, 'image').then(function (obj) {
            console.log(obj);
            if (obj.type !== 'image') return;
            // var img = document.querySelector('#debugImg');
            var img;
            if (!img) img = document.createElement('img');
            // img.id = 'debugImg';
            img.style.position = 'absolute';
            env.u8 = obj.u8;
            env.char = new MapleSprite(obj.u8, obj.data.width, obj.data.height);
            img.src = env.char.ImageURLBlob();
            document.body.appendChild(img);
         });
      }
   </script>
   </body>
</html>